# API Invocation Mapping

| Source File:Line | Call Type | Endpoint/Topic | Method/Topic Action | Base URL/WS Endpoint | Payload/Params Summary | Headers/Auth | Symbol Format | Status (match/deviation/rationale) | Notes |
|------------------|-----------|----------------|---------------------|----------------------|------------------------|--------------|--------------|-------------------------------------|-------|
| backend/exchange/exchange_gateway.py:96-111 | REST (SDK) | configs_v3, get_account_v3 | GET | apexomni HTTP base (testnet/main) via SDK | None (initial priming) | HMAC via SDK | n/a | Deviation: configs_v3 not in cheat sheet; get_account_v3 aligns to `/v3/account` | Used for client priming |
| backend/exchange/exchange_gateway.py:195-217 | REST (SDK) fallback | get_worst_price (manual), ticker_v3 | GET | apexomni HTTP public base | Params: symbol (e.g., BTC-USDT) | None (public) | REST hyphen symbols (assumed) | Match: `/v3/get-worst-price` documented; ticker_v3 aligns to `/v3/ticker` | REST price fallback when WS/cache unavailable; risk of staleness if WS disabled |
| backend/exchange/exchange_gateway.py:218-236 | REST (manual) | `/api/v3/ticker` | GET | https://testnet.omni.apex.exchange, https://omni.apex.exchange (QA removed) | Params: symbol | None (public) | REST hyphen symbols (assumed) | Match (ticker path); base URLs aligned to cheat sheet | Manual HTTP fallback outside SDK if public client fails; not WS-based |
| backend/exchange/exchange_gateway.py:488 | REST (SDK) | configs_v3 | GET | apexomni HTTP base | None | HMAC via SDK | n/a | Deviation: not in cheat sheet | Retry prime |
| backend/exchange/exchange_gateway.py:579, 656, 686 | REST (SDK) | get_account_v3 | GET | apexomni HTTP base | None | HMAC via SDK | n/a | Match `/v3/account` | Used for balances/positions fallback |
| backend/exchange/exchange_gateway.py:609-654 | REST (SDK) | get_account_balance_v3 | GET | apexomni HTTP base | None | HMAC via SDK | n/a | Match `/v3/account-balance` | Preferred for equity/available balance |
| repo scan | REST | `/v3/set-initial-margin-rate` | POST | n/a | n/a | n/a | n/a | Not used in codebase | Documented as out of scope for current feature; add later if needed |
| backend/exchange/exchange_gateway.py:706-715 | REST (SDK) | open_orders_v3 | GET | apexomni HTTP base | None | HMAC via SDK | n/a | Match `/v3/open-orders` | Uses WS cache first, then REST |
| backend/exchange/exchange_gateway.py:723-738 | REST (SDK) | create_order_v3 | POST | apexomni HTTP base | Payload includes symbol, side, type=LIMIT, price, size, reduceOnly, clientId (UUID), timeInForce=GTC, optional TP/SL; clientOrderId kept for tracking but stripped before SDK call | HMAC via SDK | REST hyphen symbols | Partial: SDK signature differs (no limitFee/expiration/clientOrderId) from cheat sheet; relies on clientId/timeInForce | Builds payload via `_build_order_payload`; limitFee/expiration not sent (SDK mismatch) |
| backend/exchange/exchange_gateway.py:747-768 | REST (SDK) | delete_order_by_client_order_id_v3 | POST | apexomni HTTP base | Body: id (clientOrderId) | HMAC via SDK | REST hyphen symbols | Match `/v3/delete-client-order-id` | Retry on conflict |
| backend/exchange/exchange_gateway.py:776-789 | REST (SDK) | delete_order_v3 | POST | apexomni HTTP base | Body: id (orderId) | HMAC via SDK | REST hyphen symbols | Match `/v3/delete-order` | Retry on conflict |
| backend/exchange/exchange_gateway.py:795-797 | REST (SDK) | delete_open_orders_v3 | POST | apexomni HTTP base | Params: optional symbol | HMAC via SDK | REST hyphen symbols | Match `/v3/delete-open-orders` | Cancels all or by symbol |
| backend/exchange/exchange_gateway.py:127-159 | WebSocket (SDK) | public: all_ticker_stream; private: account_info_stream_v3 | Subscribe | apexomni WS main/test via constants | None (library-managed) | API key/passphrase via SDK for private | WS concat symbols (`BTCUSDT` assumed) | Documented mapping: all_ticker_stream ↔ `instrumentInfo`, account_info_stream_v3 ↔ `ws_zk_accounts_v3` (via SDK helpers) | WS streaming used when `apex_enable_ws` true; REST fallbacks otherwise |
| ui/ (search) | n/a | n/a | n/a | n/a | n/a | n/a | n/a | None found after scan | UI has no direct ApeX API calls |
| consolidation summary | n/a | all above | n/a | n/a | n/a | n/a | n/a | Partial consolidation: clients/WS now centralized in `backend/exchange/apex_client.py`; `exchange_gateway` consumes wrapper | Further consolidation optional; document any deviations |
